<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Inventario</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        const { AlertCircle, Package, ShoppingCart, Users, FileText, TrendingUp, LogOut, Plus, Edit, Trash2 } = lucide;

        const InventorySystem = () => {
          const [isLoggedIn, setIsLoggedIn] = useState(false);
          const [currentUser, setCurrentUser] = useState(null);
          const [loginError, setLoginError] = useState('');

          const [users] = useState([
            { username: 'admin', password: 'admin123', role: 'Administrador' },
            { username: 'vendedor1', password: 'vend123', role: 'Vendedor' },
            { username: 'almacen1', password: 'alm123', role: 'Almac√©n' }
          ]);

          const [products, setProducts] = useState([
            { id: 1, name: 'Laptop HP', price: 800, cost: 600, stock: 15, minStock: 5 },
            { id: 2, name: 'Mouse Logitech', price: 25, cost: 15, stock: 50, minStock: 20 },
            { id: 3, name: 'Teclado Mec√°nico', price: 80, cost: 50, stock: 3, minStock: 10 },
            { id: 4, name: 'Monitor Samsung 24"', price: 200, cost: 150, stock: 8, minStock: 5 }
          ]);

          const [sales, setSales] = useState([]);
          const [managedUsers, setManagedUsers] = useState([...users]);
          const [currentView, setCurrentView] = useState('dashboard');
          const [loginForm, setLoginForm] = useState({ username: '', password: '' });
          const [saleCart, setSaleCart] = useState([]);
          const [productForm, setProductForm] = useState({ id: null, name: '', price: '', cost: '', stock: '', minStock: '' });
          const [userForm, setUserForm] = useState({ username: '', password: '', role: 'Vendedor' });
          const [editingProduct, setEditingProduct] = useState(null);
          const [reportType, setReportType] = useState('daily');

          const handleLogin = (e) => {
            e.preventDefault();
            setLoginError('');

            const user = users.find(u => u.username === loginForm.username);
            
            if (!user) {
              setLoginError('El usuario no existe');
              return;
            }

            if (user.password !== loginForm.password) {
              setLoginError('Contrase√±a incorrecta. Intente nuevamente.');
              return;
            }

            setCurrentUser(user);
            setIsLoggedIn(true);
            setLoginForm({ username: '', password: '' });
          };

          const handleLogout = () => {
            setIsLoggedIn(false);
            setCurrentUser(null);
            setCurrentView('dashboard');
          };

          const addToCart = (productId) => {
            const product = products.find(p => p.id === productId);
            const cartItem = saleCart.find(item => item.productId === productId);

            if (cartItem && cartItem.quantity >= product.stock) {
              alert('No hay suficiente existencia para este producto');
              return;
            }

            if (!cartItem && product.stock <= 0) {
              alert('Producto sin existencias');
              return;
            }

            if (cartItem) {
              setSaleCart(saleCart.map(item =>
                item.productId === productId
                  ? { ...item, quantity: item.quantity + 1 }
                  : item
              ));
            } else {
              setSaleCart([...saleCart, { productId, quantity: 1, product }]);
            }
          };

          const removeFromCart = (productId) => {
            setSaleCart(saleCart.filter(item => item.productId !== productId));
          };

          const confirmSale = () => {
            if (saleCart.length === 0) {
              alert('El carrito est√° vac√≠o');
              return;
            }

            let total = 0;
            let utility = 0;

            saleCart.forEach(item => {
              const subtotal = item.product.price * item.quantity;
              const cost = item.product.cost * item.quantity;
              total += subtotal;
              utility += (subtotal - cost);
            });

            const newSale = {
              id: sales.length + 1,
              date: new Date().toLocaleString(),
              items: [...saleCart],
              total,
              utility,
              seller: currentUser.username
            };

            setSales([...sales, newSale]);

            const updatedProducts = products.map(product => {
              const cartItem = saleCart.find(item => item.productId === product.id);
              if (cartItem) {
                return { ...product, stock: product.stock - cartItem.quantity };
              }
              return product;
            });

            setProducts(updatedProducts);
            setSaleCart([]);
            alert(`Venta registrada exitosamente!\nTotal: $${total.toFixed(2)}\nUtilidad: $${utility.toFixed(2)}`);
          };

          const handleProductSubmit = (e) => {
            e.preventDefault();

            if (!productForm.name || !productForm.price || !productForm.cost || !productForm.stock || !productForm.minStock) {
              alert('Todos los campos son obligatorios');
              return;
            }

            if (editingProduct) {
              setProducts(products.map(p =>
                p.id === editingProduct
                  ? { ...p, ...productForm, price: parseFloat(productForm.price), cost: parseFloat(productForm.cost), stock: parseInt(productForm.stock), minStock: parseInt(productForm.minStock) }
                  : p
              ));
              setEditingProduct(null);
            } else {
              if (products.find(p => p.name.toLowerCase() === productForm.name.toLowerCase())) {
                alert('Ya existe un producto con ese nombre');
                return;
              }

              const newProduct = {
                id: products.length + 1,
                name: productForm.name,
                price: parseFloat(productForm.price),
                cost: parseFloat(productForm.cost),
                stock: parseInt(productForm.stock),
                minStock: parseInt(productForm.minStock)
              };
              setProducts([...products, newProduct]);
            }

            setProductForm({ id: null, name: '', price: '', cost: '', stock: '', minStock: '' });
          };

          const editProduct = (product) => {
            setEditingProduct(product.id);
            setProductForm({
              name: product.name,
              price: product.price.toString(),
              cost: product.cost.toString(),
              stock: product.stock.toString(),
              minStock: product.minStock.toString()
            });
          };

          const deleteProduct = (productId) => {
            if (confirm('¬øEst√° seguro de eliminar este producto?')) {
              setProducts(products.filter(p => p.id !== productId));
            }
          };

          const updateStock = (productId, newStock) => {
            if (isNaN(newStock) || newStock < 0) {
              alert('Cantidad inv√°lida. Ingrese un n√∫mero v√°lido.');
              return;
            }

            setProducts(products.map(p =>
              p.id === productId ? { ...p, stock: parseInt(newStock) } : p
            ));
          };

          const getLowStockProducts = () => {
            return products.filter(p => p.stock < p.minStock);
          };

          const handleUserSubmit = (e) => {
            e.preventDefault();

            if (!userForm.username || !userForm.password || !userForm.role) {
              alert('Todos los campos son obligatorios');
              return;
            }

            if (managedUsers.find(u => u.username === userForm.username)) {
              alert('El usuario ya existe');
              return;
            }

            setManagedUsers([...managedUsers, { ...userForm }]);
            setUserForm({ username: '', password: '', role: 'Vendedor' });
            alert('Usuario creado exitosamente');
          };

          const deleteUser = (username) => {
            if (username === 'admin') {
              alert('No se puede eliminar el usuario administrador');
              return;
            }
            if (confirm('¬øEst√° seguro de eliminar este usuario?')) {
              setManagedUsers(managedUsers.filter(u => u.username !== username));
            }
          };

          const generateReport = () => {
            const lowStock = getLowStockProducts();
            return {
              totalSales: sales.reduce((sum, sale) => sum + sale.total, 0),
              totalUtility: sales.reduce((sum, sale) => sum + sale.utility, 0),
              salesCount: sales.length,
              lowStockCount: lowStock.length,
              topProducts: products.sort((a, b) => b.stock - a.stock).slice(0, 5)
            };
          };

          // Iconos personalizados simples
          const Icon = ({ name, size = 20 }) => {
            const icons = {
              'alert': '‚ö†Ô∏è',
              'package': 'üì¶',
              'cart': 'üõí',
              'users': 'üë•',
              'file': 'üìÑ',
              'trending': 'üìà',
              'logout': 'üö™',
              'edit': '‚úèÔ∏è',
              'trash': 'üóëÔ∏è'
            };
            return <span style={{ fontSize: size }}>{icons[name] || '‚Ä¢'}</span>;
          };

          if (!isLoggedIn) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4">
                <div className="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md">
                  <h1 className="text-3xl font-bold text-center mb-6 text-gray-800">Sistema de Inventario</h1>
                  <form onSubmit={handleLogin} className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Usuario</label>
                      <input
                        type="text"
                        value={loginForm.username}
                        onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Ingrese su usuario"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Contrase√±a</label>
                      <input
                        type="password"
                        value={loginForm.password}
                        onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Ingrese su contrase√±a"
                      />
                    </div>
                    {loginError && (
                      <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        {loginError}
                      </div>
                    )}
                    <button
                      type="submit"
                      className="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200 font-semibold"
                    >
                      Iniciar Sesi√≥n
                    </button>
                  </form>
                  <div className="mt-6 text-sm text-gray-600">
                    <p className="font-semibold mb-2">Usuarios de prueba:</p>
                    <p>‚Ä¢ admin / admin123 (Administrador)</p>
                    <p>‚Ä¢ vendedor1 / vend123 (Vendedor)</p>
                    <p>‚Ä¢ almacen1 / alm123 (Almac√©n)</p>
                  </div>
                </div>
              </div>
            );
          }

          const getMenuItems = () => {
            const baseItems = [
              { id: 'dashboard', name: 'Inicio', icon: 'trending', roles: ['Administrador', 'Vendedor', 'Almac√©n'] }
            ];

            if (currentUser.role === 'Vendedor' || currentUser.role === 'Administrador') {
              baseItems.push({ id: 'sales', name: 'Registrar Venta', icon: 'cart', roles: ['Vendedor', 'Administrador'] });
            }

            if (currentUser.role === 'Administrador' || currentUser.role === 'Almac√©n') {
              baseItems.push({ id: 'products', name: 'Gestionar Productos', icon: 'package', roles: ['Administrador', 'Almac√©n'] });
              baseItems.push({ id: 'inventory', name: 'Inventario', icon: 'package', roles: ['Administrador', 'Almac√©n'] });
            }

            if (currentUser.role === 'Administrador' || currentUser.role === 'Vendedor') {
              baseItems.push({ id: 'reports', name: 'Reportes', icon: 'file', roles: ['Administrador', 'Vendedor'] });
            }

            if (currentUser.role === 'Administrador') {
              baseItems.push({ id: 'users', name: 'Gestionar Usuarios', icon: 'users', roles: ['Administrador'] });
            }

            return baseItems.filter(item => item.roles.includes(currentUser.role));
          };

          const lowStockProducts = getLowStockProducts();

          return (
            <div className="min-h-screen bg-gray-100">
              <div className="bg-blue-600 text-white p-4 shadow-lg">
                <div className="container mx-auto flex justify-between items-center">
                  <h1 className="text-2xl font-bold">Sistema de Inventario</h1>
                  <div className="flex items-center gap-4">
                    <span className="text-sm">
                      {currentUser.username} ({currentUser.role})
                    </span>
                    <button
                      onClick={handleLogout}
                      className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded flex items-center gap-2"
                    >
                      <Icon name="logout" size={16} />
                      Salir
                    </button>
                  </div>
                </div>
              </div>

              <div className="container mx-auto p-4 flex gap-4">
                <div className="w-64 bg-white rounded-lg shadow p-4">
                  <nav className="space-y-2">
                    {getMenuItems().map(item => (
                      <button
                        key={item.id}
                        onClick={() => setCurrentView(item.id)}
                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition ${
                          currentView === item.id
                            ? 'bg-blue-600 text-white'
                            : 'hover:bg-gray-100 text-gray-700'
                        }`}
                      >
                        <Icon name={item.icon} />
                        {item.name}
                      </button>
                    ))}
                  </nav>

                  {(currentUser.role === 'Administrador' || currentUser.role === 'Almac√©n') && lowStockProducts.length > 0 && (
                    <div className="mt-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                      <div className="flex items-center gap-2 text-red-700 font-semibold mb-2">
                        <Icon name="alert" />
                        Alertas de Inventario
                      </div>
                      <p className="text-sm text-red-600 mb-2">{lowStockProducts.length} producto(s) bajo m√≠nimo:</p>
                      {lowStockProducts.map(p => (
                        <p key={p.id} className="text-xs text-red-600">‚Ä¢ {p.name}: {p.stock} unidades</p>
                      ))}
                    </div>
                  )}
                </div>

                <div className="flex-1 bg-white rounded-lg shadow p-6">
                  {currentView === 'dashboard' && (
                    <div>
                      <h2 className="text-2xl font-bold mb-6">Panel de Control</h2>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="bg-blue-100 p-6 rounded-lg">
                          <h3 className="text-lg font-semibold text-blue-800">Total Productos</h3>
                          <p className="text-3xl font-bold text-blue-600">{products.length}</p>
                        </div>
                        {(currentUser.role === 'Administrador' || currentUser.role === 'Vendedor') && (
                          <>
                            <div className="bg-green-100 p-6 rounded-lg">
                              <h3 className="text-lg font-semibold text-green-800">Ventas Registradas</h3>
                              <p className="text-3xl font-bold text-green-600">{sales.length}</p>
                            </div>
                            <div className="bg-purple-100 p-6 rounded-lg">
                              <h3 className="text-lg font-semibold text-purple-800">Total Ventas</h3>
                              <p className="text-3xl font-bold text-purple-600">
                                ${sales.reduce((sum, sale) => sum + sale.total, 0).toFixed(2)}
                              </p>
                            </div>
                          </>
                        )}
                      </div>
                    </div>
                  )}

                  {currentView === 'sales' && (
                    <div>
                      <h2 className="text-2xl font-bold mb-6">Registrar Venta</h2>
                      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                          <h3 className="text-lg font-semibold mb-4">Productos Disponibles</h3>
                          <div className="space-y-2 max-h-96 overflow-y-auto">
                            {products.filter(p => p.stock > 0).map(product => (
                              <div key={product.id} className="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <div>
                                  <p className="font-semibold">{product.name}</p>
                                  <p className="text-sm text-gray-600">Precio: ${product.price} | Stock: {product.stock}</p>
                                </div>
                                <button
                                  onClick={() => addToCart(product.id)}
                                  className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                                >
                                  Agregar
                                </button>
                              </div>
                            ))}
                          </div>
                        </div>
                        <div>
                          <h3 className="text-lg font-semibold mb-4">Carrito de Venta</h3>
                          {saleCart.length === 0 ? (
                            <p className="text-gray-500">El carrito est√° vac√≠o</p>
                          ) : (
                            <>
                              <div className="space-y-2 mb-4">
                                {saleCart.map(item => (
                                  <div key={item.productId} className="


